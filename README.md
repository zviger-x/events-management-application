# Events Management Application - backend-сервер для организации событий

Приложение основано на микросервисной архитектуре и предназначено для управления пользователями, мероприятиями, уведомлениями и оплатой.

## Микросервисы

- **Пользователи** - регистрация, авторизация, роли
- **Мероприятия** - полное управление (CRUD), покупка мест, комментарии и прочее
- **Уведомления** - отправка уведомлений в реальном времени, повторные попытки (retry)
- **Оплата** - приём платежей, отправка в заглушку и возврат результата

## Используемые технологии и подходы

#### Архитектуры
- Чистая архитектура (Clean Architecture)
- Многослойная архитектура (N-layer)
- CQRS с использованием MediatR

#### Технологии
- ASP.NET Core, EF Core, AutoMapper
- MS SQL и MongoDB
- Redis - кэширование и разрешение race condition
- Kafka - обмен событиями между микросервисами
- gRPC - взаимодействие между микросервисами
- SignalR - отправка real-time уведомлений (в текущей версии фронтенд отсутствует, уведомления идут в пустоту)
- Hangfire - фоновые задачи (например, напоминания об ивентах)
- JWT + Refresh Tokens - аутентификация
- RBAC - роли: пользователь, админ, менеджер ивентов

#### Тестирование и валидация
- Unit и Integration тесты (покрытие частичное)
- FluentValidation
- Bogus

#### Инфраструктура
- Docker - контейнеризация всех API
- Docker Compose - сборка микросервисов и внешних компонентов
- Ocelot - API Gateway
- Serilog + ELK - централизованное логирование и мониторинг

## Запуск проекта

### 1. Генерация HTTPS-сертификата (один раз)

Создание папки для сертификата, если отсутствует
```
mkdir "$env:APPDATA\\ASP.NET\\Https" -Force
```
Создание сертификата
```
dotnet dev-certs https --export-path "$env:APPDATA\\ASP.NET\\Https\\events-management-application-dev.pfx" --password "1234"
```

### 2. Запуск контейнеров через PowerShell-скрипт

В корневой директории проекта находится скрипт `docker-compose.ps1`, который позволяет управлять всеми микросервисами и инфраструктурой.
```
./docker-compose.ps1 up -b
```

Флаги:
- `up` - запуск всех контейнеров
- `up -b` - запуск всех контейнеров с ребилдом C#-проектов
- `down` - остановка и удаление всех контейнеров
- `down -v` - остановка, удаление контейнеров и связанных томов

Также можно запускать docker-compose вручную.
Нужно для начала создать сеть `internal-docker-network` и запустить docker-compose из каждой из следующих папок:
- `UsersMicroservice`
- `PaymentMicroservice`
- `NotificationsMicroservice`
- `EventsMicroservice`
- `Gateway`
- `KafkaServer`
- `ELK`

После запуска всех контейнеров и их инициализации API будет доступен по адресу:  
https://localhost:8081/swagger

Интерфейс Kibana (ELK) доступен по адресу: http://localhost:5601/  
Вы можете импортировать дашборд из файла `ELK/exported_dashboard.ndjson`.

### 3. Дефолтные пользователи

| Роль    | Email               | Пароль |
|---------|---------------------|--------|
| Admin   | admin@gmail.com     | admin  |
| User    | user1@gmail.com     | user1  |
| User    | user2@gmail.com     | user2  |

### 4. Запуск тестов

В корне проекта есть скрипт `run-tests.ps1`, который запускает все Unit и Integration тесты.
```
./run-tests.ps1 -b
```

Флаги:
- (без флагов) - просто прогон всех тестов
- `-l` - запуск с подробным выводом (имена всех тестов)
- `-b` - предварительная пересборка перед запуском тестов
